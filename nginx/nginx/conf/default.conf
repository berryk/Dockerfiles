server_tokens off;

map $http_upgrade $connection_upgrade {
   default upgrade;
   ''      close;
}

http {
    
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;
 
 # Default server - returns forbidden
 
    server {
        server_name _;
    
        listen 443 ssl;
        ssl_certificate conf.d/nginx.crt;
        ssl_certificate_key conf.d/nginx.key;
    
        return 404;
    }
    
# Wetty SSH server

    server {
        server_name ssh.88highlandavenue.com; 
    
        listen 443 ssl;
        ssl_certificate conf.d/nginx.crt;
        ssl_certificate_key conf.d/nginx.key;
    
        error_page 403 /login;
       
    
        location / {
            
            satisfy all;
            auth_request /auth; 
        
            proxy_pass http://ubuntu:32768;
            proxy_redirect http://ubuntu:32768/ https://ssh.88highlandavenue.com/; 
            proxy_set_header Host  ssh.88highlandavenue.com;        
            
            include /etc/nginx/proxy.conf; 
        }
        
        include /etc/nginx/authentication.conf;
    }
    
# Portainer

    server {
        server_name portainer.88highlandavenue.com
    
        listen 443 ssl;
        ssl_certificate conf.d/nginx.crt;
        ssl_certificate_key conf.d/nginx.key;
    
        error_page 403 /login;
       
        location / {
            
            satisfy all;
            auth_request /auth; 
        
            proxy_pass http://ubuntu:9000/;
            proxy_redirect http://ubuntu:9000/ https://portainer.88highlandavenue.com/; 
            proxy_set_header Host  portainer.88highlandavenue.com;          
            
            include /etc/nginx/proxy.conf; 
        }
        
        include /etc/nginx/authentication.conf;
    }
    
# Rstudio

    server {
        server_name rstudio.88highlandavenue.com
    
        listen 443 ssl;
        ssl_certificate conf.d/nginx.crt;
        ssl_certificate_key conf.d/nginx.key;
    
        error_page 403 /login;
       
        location / {
            
            satisfy all;
            auth_request /auth; 
        
            proxy_pass http://ubuntu:8787/;
            proxy_redirect http://ubuntu:8787/ https://rstudio.88highlandavenue.com/; 
            proxy_set_header Host  rstudio.88highlandavenue.com;          
            
            include /etc/nginx/proxy.conf; 
        }
        
        include /etc/nginx/authentication.conf;
    }
     
 # Homeseer
 
     server {
        server_name home.88highlandavenue.com
    
        listen 443 ssl;
        ssl_certificate conf.d/nginx.crt;
        ssl_certificate_key conf.d/nginx.key;
    
        error_page 403 /login;
       
        location / {
            
            satisfy all;
            auth_request /auth; 
        
            proxy_pass http://homeseer;
            proxy_redirect http://homeseer https://home.88highlandavenue.com/; 
            proxy_set_header Host  home.88highlandavenue.com;          
            
            include /etc/nginx/proxy.conf; 
        }
        
        include /etc/nginx/authentication.conf;
    }
     
     
 # Remote RDP
 
     server {
        server_name remote.88highlandavenue.com
    
        listen 443 ssl;
        ssl_certificate conf.d/nginx.crt;
        ssl_certificate_key conf.d/nginx.key;
    
        error_page 403 /login;
       
        location / {
            
            satisfy all;
            auth_request /auth; 
        
            proxy_pass http://ubuntu:8080;
            proxy_redirect http://ubuntu:8080 https://remote.88highlandavenue.com/; 
            proxy_set_header Host  remote.88highlandavenue.com;          
            
            include /etc/nginx/proxy.conf; 
        }
        
        include /etc/nginx/authentication.conf;
    }
    
 # Vivopc
 
     server {
        server_name vivopc.88highlandavenue.com
    
        listen 443 ssl;
        ssl_certificate conf.d/nginx.crt;
        ssl_certificate_key conf.d/nginx.key;
    
        error_page 403 /login;
       
        location / {
            
            satisfy all;
            auth_request /auth; 
        
            proxy_pass http://ubuntu:8080/rdpdirect.html?server=vivopc;
            proxy_redirect http://ubuntu:8080 https://remote.88highlandavenue.com/; 
            proxy_set_header Host  remote.88highlandavenue.com;          
            
            include /etc/nginx/proxy.conf; 
        }
        
        include /etc/nginx/authentication.conf;
    }
 
 
}